% HBP for convolutional layer decomposed into submodules
\begin{tikzpicture}
    % first four layers
    \node (in1)
        [inner sep=0]
        {\tikz \drawMessagesWithArrows{$ \tensor{X} $}{ }{ $\HeCal \tensor{X} $}{\hNodeDistance};};
    \node (layer1)
        [anchor=south west, inner sep=0]
        at (in1.south east)
        {\tikz \drawModuleNoParams{unfold}{10};};
    \node (out1)
        [inner sep=0, anchor=south west]
        at (layer1.south east)
         {\tikz \drawMessagesWithArrows{$ \llbracket \tensor{X} \rrbracket$}{ }{ $\HeCal \llbracket \tensor{X}\rrbracket $}{\hNodeDistance};};
    \node (layer2)
        [inner sep=0pt, anchor=south west]
        at (out1.south east)
        {\tikz\drawModuleWithParams{matmul}{16}{$\tensor{W}$}{ }{ $\HeCal  \tensor{W} $};};
    \node (out2)
        [inner sep=0, anchor=south west]
        at (layer2.south east)
        {\tikz \drawMessagesWithArrows{$Z$}{ }{ $\HeCal Z $}{\hNodeDistance};};
    \node (layer3)
        [inner sep=0pt, anchor=south west]
        at (out2.south east)
        {\tikz\drawModuleWithParams{add}{16}{$b$}{ }{ $\HeCal b $};};
    \node (out3)
        [inner sep=0, anchor=south west]
        at (layer3.south east)
        {\tikz \drawMessagesWithArrows{$Y$}{ }{ $\HeCal Y $}{\hNodeDistance};};
    \node (layer4)
        [anchor=south west, inner sep=0]
        at (out3.south east)
        {\tikz \drawModuleNoParams{col2im}{10};};
    \node (out4)
        [inner sep=0, anchor=south west]
        at (layer4.south east)
        {\tikz \drawMessagesWithArrows{$\tensor{Y}$}{ }{$\HeCal \tensor{Y} $}{\hNodeDistance};};
\end{tikzpicture}
